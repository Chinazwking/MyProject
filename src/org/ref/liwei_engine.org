#+STARTUP: INDENT

* 利为引擎
** 启动流程
1. 运行core/ClientLoaderWithLog.exe
   1. 加载core/PlatformConfig.ini
      - 读取ResPath :: 游戏资源路径(贴图, 骨骼, 音乐等)
      - 读取ScriptPath :: 游戏脚本路径
      - 其他窗口设置 :: 分辨率, 大小等
   2. 检测ScriptPath下是否存在init.py和main.py
      #+BEGIN_COMMENT
      如果存在fls文件也可以, fls文件是若干py文件的打包合集, 引擎内可以识别fls文件
      的内容.
      #+END_COMMENT
   3. 执行init.py文件
      - 重定向输出 :: 输出定向到文件, 字符的本地化等
      - 添加sys.path路径 :: 用于寻找python的包, 模块
      - 其他初始化工作
   4. 执行main.py文件
      #+BEGIN_SRC python
      # 文件内必须定义:
      def Start():
          pass
      def Loop(delta_time):
          pass
      #+END_SRC
      1. 调用Loop(delta)
      2. 调用Start()

** 注意点
*** CNode对象AddChild和SetParent不会增加对象的引用计数
如果认为创建了临时对象放到节点树中, 节点树会自动管理节点, 那你就想多了. 临时
对象出了作用域会直接被释放, 必须使用Entrust持久化.
*** 局部坐标系以左下角为原点.
局部坐标系中目标的位置指的是目标的正中央(默认锚点)相对于原点的位置(不是右上或者左下).
*** 节点渲染顺序
对于任何一个节点, 先渲染所有z值小于等于0的节点, 然后渲染自身, 然后渲染大于0的节点.
如果存在z值相同的兄弟, 则按加入树的顺序依序渲染.
*** SetPos所处的坐标系永远是父节点的原始坐标, 而不是经过放缩后的
*** GetChildren()返回的节点按z值从低到高排列
*** 子类化触控事件时不要调用CreateWithFile函数
调用静态方法生成的对象不是新类型的对象, InitWithFile函数
*** 触控事件的触发顺序和节点渲染顺序相反
*** SetScale放缩方向和你指定的锚点有关, (0,0)向右上, (1,1)向左下
*** 在init.py中一定要将需要的库加入sys.path路径
*** 一定要特别注意传入定时器对象内的对象是否为弱引用
强引用非常容易导致进程阻塞
*** spine对象最后调用的AddAnimation如果不循环的话, 会导致动画停止
*** CTextObject和CUIEditText直接构造会报错
*** 单个摄像机渲染顺序
GlobalZ < 0 的任何对象
         ↓   
GlobalZ == 0 的无透明的3d网格对象
         ↓   
GlobalZ == 0 的透明3d网格对象, 以及从属的CSprite等2d对象
         ↓   
GlobalZ == 0 的其他任何对象
         ↓   
GlobalZ == 0 且设置了SetIsNoDepthTest(True)的对象
         ↓   
GlobalZ > 0 的任何对象
** UI规范
*** 命名
**** 文件命名
小写英文+下划线+数字, 不要有特殊字符, 长度不要超过四十, 目录不要超过两级.
#+BEGIN_EXAMPLE
Correct: info_001.ui, weibo_mine.py
Wrong: info 001.ui weibo_Mine.py
#+END_EXAMPLE
**** 控件命名
1. 不需要程序控制的控件(如背景层, 装饰图片等)可以使用默认命名, 可以随便更改, 删除.
2. 需要程序控制的控件(如按钮, 列表等):
   - 前缀统一m_开头
   - 驼峰命名法
   - 最后一个单词为控件类型, 如Layer, Text, Btn等
#+begin_example
Correct: m_SelectBar, m_IDScroll
Wrong: m_happen, m_ID_Scroll
#+end_example
**** 多用英文, 少用拼音
*** 层级管理
**** UI文件命名层级
以层级划分, 如玩法名/一级模块/二级模块.
**** 控件父子的节点层级
设计UI时尽量合理划分父子层级, 分而治之.(编辑器里alt+鼠标拖动即可将控件作为另一个节点的子节点)
*** 常规知识
**** 所有界面的根节点都是设备屏幕, 且其不能作为子节点
**** 界面复用
如果某一个控件需要多个相同的子控件, 不要复制多份相同的子控件, 而是通过程序创建多份子控件
**** 动态数据的使用
如果某个界面需要策划控制参数, 则可以使用动态数据保存参数
**** 模板就是预定义好的一个界面
**** 抽象控件可以将已经创建好的某个控件转为自定义控件
**** 按F5可以快速重新加载
**** 定位器用来定位子界面的位置, 无其他功能
